<%inherit file="base.html"/>
<%!
  from headphones import helpers
%>

<%def name="headerIncludes()">
  <div id="subhead_container">
    <ul id="subhead_menu">
      <li><a href="extras">Artists You May Like</a></li>
    </ul>
  </div>
</%def>

<%def name="body()">
  <form action="markArtists" method="get">
    <div class="table_wrapper table_sorting">
      <p class="right">
        <select name="action">
          <option value="pause">Pause</option>
          <option value="resume">Resume</option>
          <option value="refresh">Refresh</option>
          <option value="delete">Delete</option>
        </select>
        selected artists
        <input type="submit" value="Go">
      </p>

      <table class="display" id="artist_table">
        <thead>
          <tr>
            <th id="select"><input type="checkbox" onClick="toggle(this)" /></th>
            <th id="name">Artist Name</th>
            <th id="status">Status</th>
            <th id="album">Latest Album</th>
            <th id="have">Tracks</th>
          </tr>
        </thead>
        <tbody>
        %for artist in artists:
          <%
            totaltracks = artist['TotalTracks']
            havetracks = artist['HaveTracks']

            if not havetracks:
              havetracks = 0
            try:
              percent = (havetracks*100.0)/totaltracks
              if percent > 100:
                percent = 100
            except (ZeroDivisionError, TypeError):
              percent = 0
              totaltracks = '?'

            if artist['ReleaseDate'] and artist['LatestAlbum']:
              releasedate = artist['ReleaseDate']
              albumdisplay = '<i>%s</i> (%s)' % (artist['LatestAlbum'], artist['ReleaseDate'])
              if releasedate > helpers.today():
                grade = 'A'
              else:
                grade = 'Z'
            elif artist['LatestAlbum']:
              releasedate = ''
              grade = 'Z'
              albumdisplay = '<i>%s</i>' % artist['LatestAlbum']
            else:
              releasedate = ''
              grade = 'Z'
              albumdisplay = '<i>None</i>'

            if artist['Status'] == 'Paused':
              grade = 'X'
          %>
          <tr class="grade${grade}">
            <td id="select"><input type="checkbox" name="${artist['ArtistID']}" class="checkbox" /></td>
            <td id="name"><span title="${artist['ArtistSortName']}"></span><a href="artistPage?ArtistID=${artist['ArtistID']}">${artist['ArtistName']}</a></td>
            <td id="status">${artist['Status']}</td>
            <td id="album"><span title="${releasedate}"></span><a href="albumPage?AlbumID=${artist['AlbumID']}">${albumdisplay}</a></td>
            <td id="have"><span title="${percent}"></span><div class="progress-container"><div style="width:${percent}%"><div class="havetracks">${havetracks}/${totaltracks}</div></div></div></td>
          </tr>
        %endfor
        </tbody>
      </table>
    </div>
  </form>
</%def>

<%def name="headIncludes()">
  <link rel="stylesheet" href="css/data_table.css">
</%def>

<%def name="javascriptIncludes()">
  <script src="js/libs/jquery.dataTables.min.js"></script>
  <script>
    $(document).ready( function() {
      $('#artist_table').dataTable( {
          "aoColumns": [
            { "bSortable": false },
            { "sType": "title-string"},
            null,
            { "sType": "title-string"},
            { "sType": "title-numeric"}
          ],
          "bStateSave": true,
          "iDisplayLength": 50,
          "sPaginationType": "full_numbers"
        } );
    } );
  </script>
</%def>